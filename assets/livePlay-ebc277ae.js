import{aa as ne}from"./webClient-e9003e98.js";import{_ as ce}from"./zbz-53c88072.js";import{_ as ve}from"./teacher-img-725b40ec.js";import{$ as q}from"./jquery-0491babd.js";import{R as re}from"./ratingPopup-03f01249.js";import{u as de}from"./vue-router.esm-bundler-0ff22247.js";import{A as me}from"./accountClient-16268368.js";import{C as _e}from"./coachClient-9554e82c.js";import{P as pe}from"./publicClient-ee633572.js";import{ae as ge,f as fe,r as l,$ as he,o as Ce,H as J,G as Fe,h as i,j as n,k as e,C as Y,z as C,B as d,A as O,n as b,F as ye,V as we,x as Ie,g as ke,ag as Ee,ah as be}from"./plugin-vue_export-helper-3a3407bb.js";import"./_commonjsHelpers-725317a4.js";const De="/assets/player-img-c94ce8ab.png";const o=D=>(Ee("data-v-42b663ee"),D=D(),be(),D),Se={class:"pannel"},Be={class:"video-pannel"},$e={key:0,class:"loading-mask"},Ae={key:0,class:"loading-con"},Pe=o(()=>e("div",null,"缓冲中，请稍后",-1)),Te={key:1,class:"tip-con"},Le=o(()=>e("div",{class:"mb30"},"网络错误，与服务器断开",-1)),Ne={class:"btn-con"},We={key:2,class:"tip-con"},xe={class:"mb30"},Me={class:"video-con"},He={class:"video-left"},Re={class:"video-title"},qe=["title"],Ye={class:"time"},Oe=o(()=>e("img",{src:ce,alt:""},null,-1)),Ve={key:0,class:"player-Prompt"},je=o(()=>e("div",{class:"icon"},[e("i",{class:"iconfont iconzhuyi"})],-1)),ze=o(()=>e("div",{class:"text"}," 课程视频版权所有，禁止任何形式得转载！并未经本公司书面许可的使用行为，我公司均保留追究法律责任的权利。 ",-1)),Ue=o(()=>e("i",{class:"iconfont iconguanbi"},null,-1)),Je={class:"video-block"},Ge={id:"drawPanel"},Ke={key:0,class:"setting-pannel"},Qe=o(()=>e("img",{src:De},null,-1)),Xe={class:"text"},Ze={class:"teacher"},et={class:"tea-img"},tt=["src"],st={class:"video-right"},lt={class:"player-function"},at={class:"teacher-video"},ot=o(()=>e("div",{id:"livePlayer",style:{width:"100%",height:"100%",position:"relative"}},null,-1)),ut=[ot],it=o(()=>e("img",{src:ve},null,-1)),nt=o(()=>e("div",{class:"text"},"讲师赶来中...",-1)),ct=[it,nt],vt={class:"playback"},rt=o(()=>e("div",{class:"text"},"聊天区",-1)),dt={class:"name"},mt={class:"msg"},_t=["innerHTML"],pt={class:"msg-btn"},gt={class:"btn-block"},ft=fe({__name:"livePlay",setup(D){let G=new pe,B=new _e,K=new me;const{proxy:Q}=ke(),V=l(),r=l(1),$=l(0),F=l(),m=l(!0),_=l(!1),c=l(),p=de(),j=l(!0),S=l({}),g=l(),v=l(),y=l(),A=l(),P=l(),T=l(),L=l({}),w=l(""),N=l([]),W=l(""),f=l(!1),x=l(),u=l({}),I=l(),M=l(!1),H=l(!0);he(()=>{y.value&&(c.value.onclose=function(t){console.log(t,"WebSocket 关闭")}),DWLive.destroy(),clearInterval(x.value)}),Ce(async()=>{g.value=p.query.id,v.value=p.query.courseId,y.value=p.query.classId,A.value=p.query.semesterId,P.value=p.query.dateYear,T.value=p.query.courseNameId;let t=await K.checkLogIn();t&&(S.value=await t,W.value=await S.value.nickName,await G.checkIsOrder(1,v.value).then(s=>{if(!s){window.location.href=`/coachcourse/liveCourse?id=${v.value}`;return}}),await z(),y.value?await X():m.value=!1,await te())});const X=()=>{B.getWatchStatus().then(t=>{t.code==1?(m.value=!0,r.value=3,V.value=t.msg):R()})},Z=t=>{M.value=t,z()},z=()=>{B.getMyRatingList({courseId:v.value,chapterId:g.value}).then(t=>{t.data.length>0?H.value=!1:H.value=!0})},R=()=>{$.value==30&&(r.value=2);let t=`ws://60.216.20.210:8000/gateway/knowledge/learningRateServer?userId=${S.value.userId}&clientTypeCode=PC&chapterId=${g.value}&classId=${y.value}&courseId=${v.value}&courseNameId=${T.value}&dateYear=${P.value}&nodeId=&semesterId=${A.value}`;c.value=new WebSocket(t),c.value.onopen=function(){console.log("WebSocket创建成功"),r.value!=3&&(m.value=!1,clearInterval(x.value),x.value=setInterval(()=>{ee()},1e3)),clearInterval(F.value)},c.value.onmessage=function(s){console.log(s,"WebSocket接收数据")},c.value.onerror=function(s){console.log(s,"WebSocket 报错"),m.value=!0,setTimeout(()=>{R()},1e3),clearInterval(F.value),F.value=setInterval(()=>{$.value++},1e3)},c.value.onclose=function(s){console.log(s,"WebSocket 关闭"),m.value=!0,setTimeout(()=>{R()},1e3),clearInterval(F.value),F.value=setInterval(()=>{$.value++},1e3)}},ee=()=>{let t={classId:y.value,semesterId:A.value,dateYear:P.value,courseNameId:T.value,courseId:v.value,chapterId:g.value,nodeId:"",userId:S.value.userId,clientType:"PC",videoTypeCode:1,videoDuration:u.value.videoDurationSec,currentSeeSec:1,multiple:1,liveStatus:1,liveStartTime:u.value.liveStartTime};c.value.readyState==1&&c.value.send(JSON.stringify(t))},te=async()=>{let t=await B.queryCourseDetails(v.value);L.value=await t.data;for(let s of t.data.liveList)s.liveChapterId==g.value&&(u.value=await s,document.title=await s.liveChapterName);u.value.liveCourseStatus==1?(f.value=await!0,await se()):f.value=await!1},se=()=>{var t=u.value.limitPlaySec,s=t.split("&")[0],k=s.split("=")[1],a=t.split("&")[1],h=a.split("=")[1];DWLive.init({userid:h,roomid:k,viewertoken:"123",pcH5Live:!0,viewername:W.value}),DWLive.onLiveStart=function(E){console.log(E)},DWLive.onLiveEnd=function(E){console.log(E),H.value&&(M.value=!0),document.webkitFullscreenElement&&document.webkitCancelFullScreen()},DWLive.onPublicChatMessage=async function(E){let U=JSON.parse(E);N.value=await N.value.concat(U),await Q.$forceUpdate(),J(()=>{I.value.scrollTop=I.value.scrollHeight})}},le=()=>{w.value!=""?(DWLive.sendPublicChatMsg(w.value),w.value="",J(()=>{I.value.scrollTop=I.value.scrollHeight})):alert("请输入内容~！")},ae=t=>{if(!q.trim(t))return"";t=t.replace(/\</g,"&lt;"),t=t.replace(/\>/g,"&gt;"),t=t.replace(/\n/g,"<br/>"),t=t.replace(/\[em_([0-9]*)\]/g,'<img src="//view.csslcloud.net/img/em/$1.gif" border="0" />'),t=t.replace(/\[em2_([0-9]*)\]/g,'<img src="//view.csslcloud.net/img/em2/$1.png" border="0" />');var s="";return q.each(t.split(" "),function(k,a){if(a=q.trim(a),a.indexOf("[uri_")==0&&a.indexOf("]")==a.length-1&&a.length>6){var h=a.substring(5,a.length-1)+" ";s+='<a target="_blank" style="color: #2f53ff" href="'+h+'">'+h+"</a> "}else s+=a+" "}),s},oe=()=>{let t=document.webkitFullscreenElement,s=document.getElementById("drawPanel");t?document.webkitCancelFullScreen():s.webkitRequestFullScreen(),setTimeout(()=>{_.value=!1},2e3)},ue=()=>{window.location.reload()},ie=()=>{window.close()};return(t,s)=>{const k=Fe("el-svg-icon");return i(),n("div",Se,[e("div",Be,[m.value?(i(),n("div",$e,[r.value==1?(i(),n("div",Ae,[Y(k,{name:"Loading",size:20,color:"#fff",class:"icon"}),Pe])):C("",!0),r.value==2?(i(),n("div",Te,[Le,e("div",Ne,[e("div",{onClick:s[0]||(s[0]=a=>r.value=1)},"继续等待"),e("div",{onClick:s[1]||(s[1]=a=>ue())},"重新播放")])])):C("",!0),r.value==3?(i(),n("div",We,[e("div",xe,d(V.value),1),e("div",{class:"btn-con"},[e("div",{onClick:ie},"我知道了")])])):C("",!0)])):C("",!0),e("div",Me,[e("div",He,[e("div",Re,[e("div",{class:"title oneEllipsis",title:u.value.liveChapterName},d(u.value.liveChapterName),9,qe),e("div",Ye,[Oe,O(" 直播时间： "+d(t.$dayjs(u.value.liveStartTime).format("YYYY-MM-DD HH:mm"))+" - "+d(t.$dayjs(u.value.liveEndTime).format("HH:mm")),1)])]),j.value?(i(),n("div",Ve,[je,ze,e("div",{class:"player-Prompt-close",onClick:s[2]||(s[2]=a=>j.value=!1)},[O(" 关闭 "),Ue])])):C("",!0),e("div",Je,[e("div",{class:"player-main",onMouseover:s[4]||(s[4]=a=>_.value=!0),onMouseleave:s[5]||(s[5]=a=>_.value=!1)},[e("div",{class:b(["style1",f.value?"":"null"])},[e("div",Ge,[e("div",{class:"play-mask",onClick:s[3]||(s[3]=a=>_.value=!_.value)},[_.value?(i(),n("div",Ke,[Y(k,{name:"FullScreen",color:"#fff",size:30,class:"full-screen-btn",title:"点击全屏/取消全屏",onClick:oe})])):C("",!0)])])],2),e("div",{class:b(f.value?"null":"playIsnull")},[Qe,e("div",Xe,d(u.value.liveCourseStatus==0?"直播未开始":""),1)],2)],32)]),e("div",Ze,[e("div",et,[e("img",{src:L.value.teacherPortrait,alt:""},null,8,tt)]),O(" 讲师："+d(L.value.teacherName),1)])]),e("div",st,[e("div",lt,[e("div",at,[e("div",{class:b(["style1",f.value?"":"null"])},ut,2),e("div",{class:b(f.value?"null":"playIsnull")},ct,2)])]),e("div",vt,[rt,e("div",{class:"msg-list",id:"msg-list",ref_key:"chatContent",ref:I},[(i(!0),n(ye,null,we(N.value,(a,h)=>(i(),n("div",{class:b(a.username==W.value?"my msg-item":"msg-item"),key:h},[e("div",dt,d(a.username),1),e("div",mt,[e("div",{innerHTML:ae(a.msg)},null,8,_t)])],2))),128))],512),e("div",pt,[e("div",gt,[Ie(e("input",{placeholder:"参与聊天","onUpdate:modelValue":s[6]||(s[6]=a=>w.value=a)},null,512),[[ne,w.value]]),e("div",{class:"submit",onClick:s[7]||(s[7]=a=>le())},"发送")])])])])])]),Y(re,{show:M.value,courseId:v.value,chapterId:g.value,onClickClose:Z},null,8,["show","courseId","chapterId"])])}}}),Bt=ge(ft,[["__scopeId","data-v-42b663ee"]]);export{Bt as default};
