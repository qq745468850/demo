import{K as b}from"./KnowledgeView-0b059b91.js";import{R as S}from"./ratingPopup-03f01249.js";import{D as C}from"./DataView-165e7041.js";import{A as T}from"./accountClient-16268368.js";import{C as P}from"./coachClient-9554e82c.js";import{P as j}from"./publicClient-ee633572.js";import{_ as O}from"./video-img1-ca5161b6.js";import{ae as R,G as u,h as o,j as n,C as p,z as c,k as s,B as g,A as w,F as L,V as N,t as D,v as W,n as x,ag as E,ah as V}from"./plugin-vue_export-helper-3a3407bb.js";import"./webClient-e9003e98.js";import"./_commonjsHelpers-725317a4.js";import"./user-b1b56a44.js";import"./evaluatView-3653adba.js";import"./learningCenterClient-fe7fe350.js";import"./vue-router.esm-bundler-0ff22247.js";let F=new j,y=new P,H=new T;const Y={components:{KnowledgeView:b,DataView:C,RatingPopup:S},data(){return{loadingTip:"",loadingTipType:1,loadingTime:0,loadingInterval:"",countTimeInterval:"",countTime:0,loading:!0,firstRating:!0,showRating:!1,showSettingPannel:!1,showLogo:!1,webSocket:{},dataList:[],dataDialog:!1,timer:"",userInfo:{},classId:0,semesterId:"",dateYear:"",courseNameId:"",id:"",courseId:"",showPrompt:!0,liveshow:{},onSpeed:"1.0",playerObj:{},chapterObj:{},seek:0,timePoint:0}},destoryed(){this.webSocket.onclose=function(e){console.log(e,"WebSocket 关闭")},this.chapterObj.ccPlaybackId&&this.chapterObj.liveRootId?$.DW.destroy():this.playerObj.dispose(),clearInterval(this.timer),clearInterval(this.countTimeInterval),clearInterval(this.loadingInterval)},async created(){this.id=this.$route.query.id,this.courseId=this.$route.query.courseId,this.classId=this.$route.query.classId,this.semesterId=this.$route.query.semesterId,this.dateYear=this.$route.query.dateYear,this.courseNameId=this.$route.query.courseNameId;let e=await H.checkLogIn();e&&(this.userInfo=e,F.checkIsOrder(1,this.courseId).then(t=>{if(!t){window.location.href=`/coachcourse/liveCourse?id=${this.courseId}`;return}}),this.classId?await this.getWatchStatus():this.loading=await!1,await this.getLiveData())},methods:{getWatchStatus(){y.getWatchStatus().then(e=>{e.code==1&&(this.loading=!0,this.loadingTipType=3,this.loadingTip=e.msg)})},clickClose(e){this.showRating=e,this.getMyRatingList()},getMyRatingList(){y.getMyRatingList({courseId:this.courseId,chapterId:this.id}).then(e=>{e.data.length>0?this.firstRating=!1:this.firstRating=!0})},webSocketConnection(){let e=this;e.loadingTime==30&&(e.loadingTipType=2);var t=$("video")[0];let a=`ws://60.216.20.210:8000/gateway/knowledge/learningRateServer?userId=${e.userInfo.userId}&clientTypeCode=PC&chapterId=${e.id}&classId=${e.classId}&courseId=${e.courseId}&courseNameId=${e.courseNameId}&dateYear=${e.dateYear}&nodeId=&semesterId=${e.semesterId}`;e.webSocket=new WebSocket(a),e.webSocket.onopen=function(){console.log("WebSocket创建成功"),t.play(),e.loadingTipType!=3&&(e.loading=!1),clearInterval(e.loadingInterval)},e.webSocket.onmessage=function(d){console.log(d,"WebSocket接收数据")},e.webSocket.onerror=function(d){console.log(d,"WebSocket 报错"),t.pause(),e.loading=!0,setTimeout(()=>{e.webSocketConnection()},1e3),clearInterval(e.loadingInterval),e.loadingInterval=setInterval(()=>{e.loadingTime++},1e3)},e.webSocket.onclose=function(d){console.log(d,"WebSocket 关闭"),t.pause(),e.loading=!0,setTimeout(()=>{e.webSocketConnection()},1e3),clearInterval(e.loadingInterval),e.loadingInterval=setInterval(()=>{e.loadingTime++},1e3)}},webSocketSend(){this.chapterObj.ccPlaybackId&&this.chapterObj.liveRootId?this.timePoint=parseInt($.DW.getPlayerTime()):this.timePoint=parseInt(this.playerObj.getCurrentTime());let e={classId:this.classId,semesterId:this.semesterId,dateYear:this.dateYear,courseNameId:this.courseNameId,courseId:this.courseId,chapterId:this.id,nodeId:"",userId:this.userInfo.userId,clientType:"PC",videoTypeCode:1,videoDuration:this.chapterObj.totalTime,currentSeeSec:this.timePoint,multiple:this.onSpeed,liveStatus:0,liveStartTime:this.chapterObj.liveStartTime};this.webSocket.readyState==1&&this.webSocket.send(JSON.stringify(e))},async getViewingHistory(){let e=await y.getViewingHistory(this.classId,this.semesterId,this.dateYear,this.courseNameId,this.courseId,this.id,void 0);e.data&&(this.seek=e.data.currentSeeSec)},async getLiveData(){let e=await y.queryCourseDetails(this.courseId);this.liveshow=e.data;for(let t of e.data.liveList)t.liveChapterId==this.id&&(this.chapterObj=t,document.title=t.liveChapterName);if(this.chapterObj.liveCourseStatus==0){alert("直播尚未开始~"),this.$router.go(-1);return}if(this.chapterObj.liveCourseStatus==1){alert("正在直播中~"),this.$router.go(-1);return}if(this.chapterObj.liveCourseStatus==2){alert("回放生成中~"),this.$router.go(-1);return}await this.getMyRatingList(),this.loadingTipType!=3&&(this.chapterObj.ccPlaybackId&&this.chapterObj.liveRootId?await this.initCCPlayer():await this.initAliPlayer())},async initAliPlayer(){this.classId&&await this.getViewingHistory();let e=this.chapterObj.aliPlaybackLink;var t=this,a=new Aliplayer({id:"player-con",source:e,width:"100%",height:"100%",autoplay:!0,preload:!0,isLive:!1,useH5Prism:!0,rePlay:!1},function(m){console.log("The player is created")});function d(){t.showLogo=!0,t.seek>0&&a.seek(t.seek),t.classId&&t.webSocketConnection()}function i(){clearInterval(t.timer),t.classId&&(t.timer=setInterval(()=>{t.webSocketSend()},1e3))}async function r(){clearInterval(countTimeInterval.value)}function v(){t.webSocket.readyState==3&&t.webSocketConnection(),t.countTimeInterval=setInterval(()=>{t.countTime++},1e3)}function _(){var m=$("video")[0];if(t.onSpeed=m.playbackRate,t.firstRating){var I=parseInt(a.getDuration());I>1200&&t.countTime>=I*.9&&(clearInterval(t.countTimeInterval),t.showRating=!0,a.pause(),document.webkitFullscreenElement&&document.webkitCancelFullScreen())}}a.on("ready",d),a.on("play",v),a.on("pause",r),a.on("playing",i),a.on("timeupdate",_),t.playerObj=a},async initCCPlayer(){this.classId&&await this.getViewingHistory(),await $.DW.config({userId:"41A331E332E32281",roomId:this.chapterObj.liveRootId,recordId:this.chapterObj.ccPlaybackId,isH5play:!0,fastMode:!0});var e=this;window.on_player_start=function(){clearInterval(e.timer),clearInterval(e.countTimeInterval),e.timer=setInterval(()=>{if(e.webSocketSend(),e.firstRating){var t=parseInt($.DW.getDuration());t>1200&&e.countTime>=t*.9&&(clearInterval(e.countTimeInterval),e.showRating=!0,$.DW.play(),document.webkitFullscreenElement&&document.webkitCancelFullScreen())}},1e3),clearInterval(e.countTimeInterval),e.countTimeInterval=setInterval(()=>{e.countTime++},1e3),e.webSocket.readyState==3&&e.webSocketConnection()},window.on_spark_player_pause=async function(){clearInterval(e.countTimeInterval)},window.on_cc_live_player_load=function(){e.showLogo=!0},window.on_cc_swf_loading_completed=function(){var t=$("video")[0];e.seek>0&&$.DW.seek(e.seek),e.classId&&e.webSocketConnection(),t.timeupdate=function(){t.play()}}},async clickData(e){this.dataDialog=!0,this.dataList=e},toLivePlayback(e){window.location.href=`/livePlayback?courseId=${this.courseId}&id=${e}&classId=${this.classId?this.classId:""}&semesterId=${this.semesterId?this.semesterId:""}&dateYear=${this.dateYear?this.dateYear:""}&courseNameId=${this.courseNameId?this.courseNameId:""}`},clickSeekTime(e){this.chapterObj.ccPlaybackId&&this.chapterObj.liveRootId?$.DW.seek(e):this.playerObj.seek(e)},clickFullScreen(){let e=document.webkitFullscreenElement,t=document.getElementById("playbackPanel");e?document.webkitCancelFullScreen():t.webkitRequestFullScreen(),setTimeout(()=>{this.showSettingPannel=!1},2e3)},reloadPage(){window.location.reload()},closeWindow(){window.close()}}},h=e=>(E("data-v-0f3baec7"),e=e(),V(),e),q={class:"pannel"},A={key:0,class:"loading-mask"},M={key:0,class:"loading-con"},z=h(()=>s("div",null,"缓冲中，请稍后",-1)),B={key:1,class:"tip-con"},K=h(()=>s("div",{class:"mb30"},"网络错误，与服务器断开",-1)),G={class:"btn-con"},J={key:2,class:"tip-con"},U={class:"mb30"},Q={class:"btn-con"},X={class:"video-pannel"},Z={class:"video-con"},ee={class:"video-left"},te={class:"video-title"},ie=["title"],se={class:"teacher"},oe={class:"tea-img"},ne=["src"],le={key:0,class:"player-Prompt"},ae=h(()=>s("div",{class:"icon"},[s("i",{class:"iconfont iconzhuyi"})],-1)),ce=h(()=>s("div",{class:"text"}," 课程视频版权所有，禁止任何形式得转载！并未经本公司书面许可的使用行为，我公司均保留追究法律责任的权利。 ",-1)),re=h(()=>s("i",{class:"iconfont iconguanbi"},null,-1)),de={id:"playbackPanel",style:{width:"100%",height:"100%"}},he={key:0,src:"https://xlc-wx.oss-cn-beijing.aliyuncs.com/xlcwx/videologo.png",alt:"",class:"logo-img"},ue={key:1,class:"setting-pannel"},pe={key:2,class:"player-main"},ve={class:"prism-player",id:"player-con"},me={key:0,src:"https://xlc-wx.oss-cn-beijing.aliyuncs.com/xlcwx/videologo.png",alt:"",class:"logo-img"},Ie={class:"player-function"},ge={class:"teacher-video"},ye={key:0,class:"style1"},_e=h(()=>s("div",{id:"playbackPlayer",style:{width:"100%",height:"100%"}},null,-1)),we=[_e],fe={key:1},ke=h(()=>s("img",{src:O},null,-1)),be=[ke],Se={class:"video-list"},Ce=h(()=>s("div",{class:"tip"},[s("i",{class:"iconfont icondaohang"}),w(" 课程列表")],-1)),Te={class:"list"},Pe=["onClick"],je={key:0,class:"iconfont iconbofangzhong"},Oe={key:1,class:"iconfont iconbofang"},Re=["title"],Le={key:2,class:"state"};function Ne(e,t,a,d,i,r){const v=u("el-svg-icon"),_=u("knowledge-view"),m=u("data-view"),I=u("el-dialog"),f=u("rating-popup");return o(),n("div",q,[i.loading?(o(),n("div",A,[i.loadingTipType==1?(o(),n("div",M,[p(v,{name:"Loading",size:20,color:"#fff",class:"icon"}),z])):c("",!0),i.loadingTipType==2?(o(),n("div",B,[K,s("div",G,[s("div",{onClick:t[0]||(t[0]=l=>i.loadingTipType=1)},"继续等待"),s("div",{onClick:t[1]||(t[1]=l=>r.reloadPage())},"重新播放")])])):c("",!0),i.loadingTipType==3?(o(),n("div",J,[s("div",U,g(i.loadingTip),1),s("div",Q,[s("div",{onClick:t[2]||(t[2]=(...l)=>r.closeWindow&&r.closeWindow(...l))},"我知道了")])])):c("",!0)])):c("",!0),s("div",X,[s("div",Z,[s("div",ee,[s("div",te,[s("div",{class:"title oneEllipsis",title:i.chapterObj.liveChapterName},g(i.chapterObj.liveChapterName),9,ie),s("div",se,[s("div",oe,[s("img",{src:i.liveshow.teacherPortrait,alt:""},null,8,ne)]),w(" 讲师："+g(i.liveshow.teacherName),1)])]),i.showPrompt?(o(),n("div",le,[ae,ce,s("div",{class:"player-Prompt-close",onClick:t[3]||(t[3]=l=>i.showPrompt=!1)},[w(" 关闭 "),re])])):c("",!0),i.chapterObj&&i.chapterObj.ccPlaybackId&&i.chapterObj.liveRootId?(o(),n("div",{key:1,class:"player-main",onMouseover:t[6]||(t[6]=l=>i.showSettingPannel=!0),onMouseleave:t[7]||(t[7]=l=>i.showSettingPannel=!1)},[s("div",de,[s("div",{class:"play-mask",onClick:t[5]||(t[5]=l=>i.showSettingPannel=!i.showSettingPannel)},[i.showLogo?(o(),n("img",he)):c("",!0),i.showSettingPannel?(o(),n("div",ue,[p(v,{name:"FullScreen",color:"#fff",size:30,class:"full-screen-btn",title:"点击全屏/取消全屏",onClick:t[4]||(t[4]=l=>r.clickFullScreen())})])):c("",!0)])])],32)):c("",!0),i.chapterObj&&i.chapterObj.aliPlaybackLink?(o(),n("div",pe,[s("div",ve,[i.showLogo?(o(),n("img",me)):c("",!0)])])):c("",!0)]),s("div",Ie,[s("div",ge,[i.chapterObj&&i.chapterObj.ccPlaybackId&&i.chapterObj.liveRootId?(o(),n("div",ye,we)):(o(),n("div",fe,be))]),s("div",Se,[Ce,s("div",Te,[(o(!0),n(L,null,N(i.liveshow.liveList,(l,k)=>(o(),n("div",{class:"jie",key:k},[s("div",{class:x(["title pointer",l.liveChapterId==i.id?"on":""]),onClick:De=>r.toLivePlayback(l.liveChapterId)},[l.liveChapterId==i.id?(o(),n("i",je)):(o(),n("i",Oe)),s("div",{class:"name oneEllipsis",title:l.liveChapterName},g(l.liveChapterName),9,Re),l.liveChapterId==i.id?(o(),n("span",Le,"正在播放")):c("",!0)],10,Pe)]))),128))])])])])]),i.liveshow?(o(),D(_,{key:1,type:1,id:i.id,courseId:i.courseId,teacherId:i.liveshow.teacherId,onClickSeekTime:r.clickSeekTime},null,8,["id","courseId","teacherId","onClickSeekTime"])):c("",!0),p(I,{title:"随堂资料",width:"720px",modelValue:i.dataDialog,"onUpdate:modelValue":t[8]||(t[8]=l=>i.dataDialog=l)},{default:W(()=>[p(m,{items:i.dataList},null,8,["items"])]),_:1},8,["modelValue"]),p(f,{show:i.showRating,courseId:i.courseId,chapterId:i.id,onClickClose:r.clickClose},null,8,["show","courseId","chapterId","onClickClose"])])}const Je=R(Y,[["render",Ne],["__scopeId","data-v-0f3baec7"]]);export{Je as default};
