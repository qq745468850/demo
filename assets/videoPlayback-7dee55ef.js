import{$ as Y}from"./jquery-0491babd.js";import{u as Ie}from"./vue-router.esm-bundler-0ff22247.js";import{K as ye}from"./KnowledgeView-0b059b91.js";import{R as ge}from"./ratingPopup-03f01249.js";import{D as ke}from"./DataView-165e7041.js";import{C as Ce}from"./coachClient-9554e82c.js";import{A as we}from"./accountClient-16268368.js";import{P as Fe}from"./publicClient-ee633572.js";import{ae as Ee,f as be,r as t,$ as Se,b as De,o as Be,G as V,h as l,j as u,C as D,z as m,k as a,B,A as M,v as T,F as te,V as oe,t as le,n as $e,ag as Ne,ah as Ae}from"./plugin-vue_export-helper-3a3407bb.js";import"./_commonjsHelpers-725317a4.js";import"./webClient-e9003e98.js";import"./user-b1b56a44.js";import"./evaluatView-3653adba.js";import"./learningCenterClient-fe7fe350.js";const F=$=>(Ne("data-v-64bdef08"),$=$(),Ae(),$),Pe={class:"pannel"},Ve={key:0,class:"loading-mask"},Te={key:0,class:"loading-con"},Le=F(()=>a("div",null,"缓冲中，请稍后",-1)),xe={key:1,class:"tip-con"},qe=F(()=>a("div",{class:"mb30"},"网络错误，与服务器断开",-1)),Re={class:"btn-con"},We={key:2,class:"tip-con"},He={class:"mb30"},je={class:"video-pannel"},ze={class:"video-con"},Oe={class:"video-left"},Ye={class:"video-title"},Me={class:"title oneEllipsis"},Ue={class:"teacher"},Ke={class:"tea-img"},Ge=["src"],Je={class:"player"},Qe={key:0,class:"player-Prompt"},Xe=F(()=>a("div",{class:"icon"},[a("i",{class:"iconfont iconzhuyi"})],-1)),Ze=F(()=>a("div",{class:"text"}," 课程视频版权所有，禁止任何形式得转载！并未经本公司书面许可的使用行为，我公司均保留追究法律责任的权利。 ",-1)),ea=F(()=>a("i",{class:"iconfont iconguanbi"},null,-1)),aa={class:"player-main"},ta={class:"prism-player",id:"player-con"},oa={key:0,src:"https://xlc-wx.oss-cn-beijing.aliyuncs.com/xlcwx/videologo.png",alt:"",class:"logo-img"},la={class:"video-list"},sa=F(()=>a("div",{class:"tip"},[a("i",{class:"iconfont icondaohang"}),M(" 课程列表")],-1)),ua={class:"list"},na=["title"],ia=["onClick"],ca={key:0,class:"iconfont iconbofangzhong"},da={key:1,class:"iconfont iconbofang"},va=["title"],ra={key:2,class:"state"},pa=be({__name:"videoPlayback",setup($){let se=new we,N=new Ce,ue=new Fe;const U=t(),p=t(1),L=t(0),f=t(),E=t(),K=t(0),h=t(!0),G=t(!1),d=t(),I=t({}),b=t({}),y=Ie(),ne=t([]),J=t(!1),x=t([]),q=t(""),R=t({}),n=t(),v=t(),g=t(),k=t(),C=t(),c=t(),Q=t(!0),w=t({}),A=t({}),S=t(0),X=t("1.0"),Z=t(0),W=t(!1),H=t(!0);Se(()=>{d.value.onclose=function(e){console.log(e,"WebSocket 关闭")},A.value.dispose(),clearInterval(q.value),clearInterval(E.value),clearInterval(f.value)}),De(()=>{n.value=y.query.id,c.value=y.query.courseId,v.value=y.query.classId,g.value=y.query.semesterId,k.value=y.query.dateYear,C.value=y.query.courseNameId}),Be(async()=>{let e=await se.checkLogIn();e&&(R.value=e,ue.checkIsOrder(2,c.value).then(o=>{if(!o){window.location.href=`/coachcourse/videoCourse?id=${c.value}`;return}}),await pe(),v.value?await ie():h.value=await!1)});const ie=()=>{N.getWatchStatus().then(e=>{e.code==1?(h.value=!0,p.value=3,U.value=e.msg):P()})},ce=e=>{W.value=e,ee()},ee=()=>{N.getMyRatingList({courseId:c.value,chapterId:I.value.videoChapterId,nodeId:n.value}).then(e=>{e.data.length>0?H.value=!1:H.value=!0})},P=()=>{L.value==30&&(p.value=2);var e=Y("video")[0];let o=`ws://60.216.20.210:8000/gateway/knowledge/learningRateServer?userId=${R.value.userId}&clientTypeCode=PC&chapterId=${I.value.videoChapterId}&classId=${v.value}&courseId=${c.value}&courseNameId=${C.value}&dateYear=${k.value}&nodeId=${n.value}&semesterId=${g.value}`;d.value=new WebSocket(o),d.value.onopen=function(){console.log("WebSocket创建成功"),e.play(),p.value!=3&&(h.value=!1),clearInterval(f.value)},d.value.onmessage=function(i){console.log(i,"WebSocket接收数据")},d.value.onerror=function(i){console.log(i,"WebSocket 报错"),e.pause(),h.value=!0,setTimeout(()=>{P()},1e3),clearInterval(f.value),f.value=setInterval(()=>{L.value++},1e3)},d.value.onclose=function(i){console.log(i,"WebSocket 关闭"),e.pause(),h.value=!0,setTimeout(()=>{P()},1e3),clearInterval(f.value),f.value=setInterval(()=>{L.value++},1e3)}},de=()=>{Z.value=parseInt(A.value.getCurrentTime());let e={classId:v.value,semesterId:g.value,dateYear:k.value,courseNameId:C.value,courseId:c.value,chapterId:I.value.videoChapterId,nodeId:n.value,userId:R.value.userId,clientType:"PC",videoTypeCode:2,videoDuration:b.value.videoDurationSec,currentSeeSec:Z.value,multiple:X.value,liveStatus:0,liveStartTime:""};d.value.readyState==1&&d.value.send(JSON.stringify(e))},ve=async()=>{await N.getViewingHistory(v.value,g.value,k.value,C.value,c.value,I.value.videoChapterId,n.value).then(e=>{e.data&&(S.value=e.data.currentSeeSec)})},re=async()=>{v.value&&await ve(),await ee();let e,o=b.value.playLink;e=new Aliplayer({id:"player-con",source:o,width:"100%",height:"100%",autoplay:!0,preload:!0,isLive:!1,useH5Prism:!0,rePlay:!1},function(_){S.value>0&&_.seek(S.value),console.log("The player is created")});function i(){if(p.value==3){var _=Y("video")[0];_.pause()}G.value=!0,S.value>0&&e.seek(S.value)}function j(){clearInterval(q.value),v.value&&(q.value=setInterval(()=>{de()},1e3))}function z(){clearInterval(E.value)}function O(){d.value.readyState==3&&P(),clearInterval(E.value),E.value=setInterval(()=>{K.value++},1e3)}function s(){var _=Y("video")[0];if(X.value=_.playbackRate,H.value){var r=parseInt(e.getDuration());r>1200&&K.value>=r*.9&&(clearInterval(E.value),W.value=!0,e.pause(),document.webkitFullscreenElement&&document.webkitCancelFullScreen())}}e.on("ready",i),e.on("play",O),e.on("pause",z),e.on("playing",j),e.on("timeupdate",s),A.value=e},pe=async()=>{let e=await N.queryCourseDetails(c.value);w.value=e.data;for(let i of e.data.videoList)for(var o of i.queryVideoNodeList)o.nodeId==n.value&&(I.value=i,b.value=o,document.title=await b.value.nodeName),n.value==o.nodeId&&x.value.push(o.nodeId);await re()},me=async e=>{A.value.seek(e)},_e=e=>{window.location.href=`/videoPlayback?courseId=${c.value}&id=${e}&classId=${v.value?v.value:""}&semesterId=${g.value?g.value:""}&dateYear=${k.value?k.value:""}&courseNameId=${C.value?C.value:""}`},fe=()=>{window.location.reload()},he=()=>{window.close()};return(e,o)=>{const i=V("el-svg-icon"),j=V("el-collapse-item"),z=V("el-collapse"),O=V("el-dialog");return l(),u("div",Pe,[h.value?(l(),u("div",Ve,[p.value==1?(l(),u("div",Te,[D(i,{name:"Loading",size:20,color:"#fff",class:"icon"}),Le])):m("",!0),p.value==2?(l(),u("div",xe,[qe,a("div",Re,[a("div",{onClick:o[0]||(o[0]=s=>p.value=1)},"继续等待"),a("div",{onClick:o[1]||(o[1]=s=>fe())},"重新播放")])])):m("",!0),p.value==3?(l(),u("div",We,[a("div",He,B(U.value),1),a("div",{class:"btn-con"},[a("div",{onClick:he},"我知道了")])])):m("",!0)])):m("",!0),a("div",je,[a("div",ze,[a("div",Oe,[a("div",Ye,[a("div",Me,B(b.value.nodeName),1),a("div",Ue,[a("div",Ke,[a("img",{src:w.value.teacherPortrait,alt:""},null,8,Ge)]),M(" 讲师："+B(w.value.teacherName),1)])]),a("div",Je,[Q.value?(l(),u("div",Qe,[Xe,Ze,a("div",{class:"player-Prompt-close",onClick:o[2]||(o[2]=s=>Q.value=!1)},[M(" 关闭 "),ea])])):m("",!0),a("div",aa,[a("div",ta,[G.value?(l(),u("img",oa)):m("",!0)])])])]),a("div",la,[sa,a("div",ua,[D(z,{modelValue:x.value,"onUpdate:modelValue":o[3]||(o[3]=s=>x.value=s)},{default:T(()=>[(l(!0),u(te,null,oe(w.value.videoList,(s,_)=>(l(),le(j,{key:_,name:s.id},{title:T(()=>[a("div",{class:"zhang oneEllipsis",title:s.videoChapterName},B(s.videoChapterName),9,na)]),default:T(()=>[(l(!0),u(te,null,oe(s.queryVideoNodeList,(r,ae)=>(l(),u("div",{class:"jie",key:ae},[a("div",{class:$e(["title pointer",r.nodeId==n.value?"on":""]),onClick:ma=>_e(r.nodeId)},[r.nodeId==n.value?(l(),u("i",ca)):(l(),u("i",da)),a("div",{class:"name oneEllipsis",title:r.nodeName},B(r.nodeName),9,va),r.nodeId==n.value?(l(),u("span",ra,"正在播放")):m("",!0)],10,ia)]))),128))]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])])])])]),w.value?(l(),le(ye,{key:1,type:2,id:n.value,courseId:c.value,teacherId:w.value.teacherId,onClickSeekTime:me},null,8,["id","courseId","teacherId"])):m("",!0),D(O,{width:"720px",modelValue:J.value,"onUpdate:modelValue":o[4]||(o[4]=s=>J.value=s)},{default:T(()=>[D(ke,{items:ne.value},null,8,["items"])]),_:1},8,["modelValue"]),D(ge,{show:W.value,courseId:c.value,chapterId:I.value.videoChapterId,nodeId:n.value,onClickClose:ce},null,8,["show","courseId","chapterId","nodeId"])])}}}),Ba=Ee(pa,[["__scopeId","data-v-64bdef08"]]);export{Ba as default};
