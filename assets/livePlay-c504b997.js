import{aa as me}from"./webClient-2e88593a.js";import{_ as pe}from"./zbz-53c88072.js";import{_ as _e}from"./teacher-img-725b40ec.js";import{$ as R}from"./jquery-0491babd.js";import{R as fe}from"./ratingPopup-59848cfb.js";import{u as ge}from"./vue-router.esm-bundler-926c5a09.js";import{A as he}from"./accountClient-b6fbd578.js";import{C as Ce}from"./coachClient-6606bd3e.js";import{P as ye}from"./publicClient-90b64d32.js";import{_ as Fe}from"./plugin-vue_export-helper-c27b6911.js";import{f as Ie,r as l,$ as we,o as ke,H as G,G as Ee,h as n,j as c,k as e,C as O,z as F,B as p,A as Y,n as D,F as be,V as De,x as Se,g as Be,af as Te,ag as Pe}from"./runtime-core.esm-bundler-201072b8.js";import"./commonjsHelpers-725317a4.js";const $e="./assets/player-img-c94ce8ab.png";const o=S=>(Te("data-v-761d72ab"),S=S(),Pe(),S),Ae={class:"pannel"},Le={class:"video-pannel"},Ne={key:0,class:"loading-mask"},We={key:0,class:"loading-con"},xe=o(()=>e("div",null,"缓冲中，请稍后",-1)),Me={key:1,class:"tip-con"},qe=o(()=>e("div",{class:"mb30"},"网络错误，与服务器断开",-1)),He={class:"btn-con"},Re={key:2,class:"tip-con"},Oe={class:"mb30"},Ye={class:"video-con"},je={class:"video-left"},Ve={class:"video-title"},ze=["title"],Ue={class:"time"},Je=o(()=>e("img",{src:pe,alt:""},null,-1)),Ge={key:0,class:"player-Prompt"},Ke=o(()=>e("div",{class:"icon"},[e("i",{class:"iconfont iconzhuyi"})],-1)),Qe=o(()=>e("div",{class:"text"}," 课程视频版权所有，禁止任何形式得转载！并未经本公司书面许可的使用行为，我公司均保留追究法律责任的权利。 ",-1)),Xe=o(()=>e("i",{class:"iconfont iconguanbi"},null,-1)),Ze={class:"video-block"},et={id:"drawPanel"},tt={key:0,class:"setting-pannel"},st=o(()=>e("img",{src:$e},null,-1)),lt={class:"text"},at={class:"teacher"},ot={class:"tea-img"},ut=["src"],it={class:"video-right"},nt={class:"player-function"},ct={class:"teacher-video"},rt=o(()=>e("div",{id:"livePlayer",style:{width:"100%",height:"100%",position:"relative"}},null,-1)),vt=[rt],dt=o(()=>e("img",{src:_e},null,-1)),mt=o(()=>e("div",{class:"text"},"讲师赶来中...",-1)),pt=[dt,mt],_t={class:"playback"},ft=o(()=>e("div",{class:"text"},"聊天区",-1)),gt={class:"name"},ht={class:"msg"},Ct=["innerHTML"],yt={class:"msg-btn"},Ft={class:"btn-block"},It=Ie({__name:"livePlay",setup(S){let K=new ye,_=new Ce,Q=new he;const{proxy:X}=Be(),j=l(),d=l(),T=l(0),I=l(),f=l(!0),g=l(!1),r=l(),h=ge(),V=l(!0),B=l({}),v=l(),i=l(),m=l(),P=l(),$=l(),A=l(),L=l({}),w=l(""),N=l([]),W=l(""),C=l(!1),x=l(),u=l({}),k=l(),Z=l({}),M=l(!1),q=l(!0),ee=l(""),te=l("");l(),l();const z=l();l(),l(),we(()=>{m.value&&(r.value.onclose=function(t){console.log(t,"WebSocket 关闭")}),Z.value.dispose(),DWLive.destroy(),clearInterval(x.value),_.receiveCourse(1)}),ke(async()=>{v.value=h.query.id,i.value=h.query.courseId,m.value=h.query.classId,P.value=h.query.semesterId,$.value=h.query.dateYear,A.value=h.query.courseNameId;let t=await Q.checkLogIn();t&&(B.value=await t,W.value=await B.value.nickName,await K.checkIsOrder(1,i.value).then(s=>{if(!s){window.location.href=`/coachcourse/liveCourse?id=${i.value}`;return}}),await U(),m.value?await se():f.value=!1,await ue(),await ae())});const se=()=>{_.getWatchStatus().then(t=>{t.code==1?(f.value=!0,d.value=3,j.value=t.msg):H()})},le=t=>{M.value=t,U()},U=()=>{_.getMyRatingList({courseId:i.value,chapterId:v.value}).then(t=>{t.data.length>0?q.value=!1:q.value=!0})},ae=()=>{_.queryCourseTasks().then(t=>{console.log("如一",t),ee.value=t.data.time,te.value=t.data.frequency})},H=()=>{T.value==30&&(d.value=2);let t=`ws://60.216.20.210:8000/gateway/knowledge/learningRateServer?userId=${B.value.userId}&clientTypeCode=PC&chapterId=${v.value}&classId=${m.value}&courseId=${i.value}&courseNameId=${A.value}&dateYear=${$.value}&nodeId=&semesterId=${P.value}`;r.value=new WebSocket(t),r.value.onopen=function(){console.log("WebSocket创建成功"),d.value!=3&&(f.value=!1,clearInterval(x.value),x.value=setInterval(()=>{oe()},1e3)),clearInterval(I.value)},r.value.onmessage=function(s){console.log(s,"WebSocket接收数据")},r.value.onerror=function(s){console.log(s,"WebSocket 报错"),f.value=!0,setTimeout(()=>{H()},1e3),clearInterval(I.value),I.value=setInterval(()=>{T.value++},1e3)},r.value.onclose=function(s){console.log(s,"WebSocket 关闭"),f.value=!0,setTimeout(()=>{H()},1e3),clearInterval(I.value),I.value=setInterval(()=>{T.value++},1e3)}},oe=()=>{_.getRecordDuration({courseId:i.value,coachClassTypeId:m.value,courseChapterId:v.value,courseChapterNodeId:z.value,teachingMethod:1,platformType:"PC"}).then(s=>{console.log("----=-=-=",s)});let t={classId:m.value,semesterId:P.value,dateYear:$.value,courseNameId:A.value,courseId:i.value,coachClassTypeId:m.value,courseChapterId:v.value,courseChapterNodeId:z.value,chapterId:v.value,nodeId:"",userId:B.value.userId,clientType:"PC",videoTypeCode:1,videoDuration:u.value.videoDurationSec,currentSeeSec:1,multiple:1,liveStatus:1,platformType:"PC",liveStartTime:u.value.liveStartTime};console.log("fff",t),r.value.readyState==1&&r.value.send(JSON.stringify(t))},ue=async()=>{let t=await _.queryCourseDetails(i.value);L.value=await t.data;for(let s of t.data.liveList)s.liveChapterId==v.value&&(u.value=await s,document.title=await s.liveChapterName);u.value.liveCourseStatus==1?(C.value=await!0,await ie()):C.value=await!1},ie=()=>{var t=u.value.limitPlaySec,s=t.split("&")[0],E=s.split("=")[1],a=t.split("&")[1],y=a.split("=")[1];DWLive.init({userid:y,roomid:E,viewertoken:"123",pcH5Live:!0,viewername:W.value}),DWLive.onLiveStart=function(b){console.log(b)},DWLive.onLiveEnd=function(b){console.log(b),q.value&&(M.value=!0),document.webkitFullscreenElement&&document.webkitCancelFullScreen()},DWLive.onPublicChatMessage=async function(b){let J=JSON.parse(b);N.value=await N.value.concat(J),await X.$forceUpdate(),G(()=>{k.value.scrollTop=k.value.scrollHeight})}},ne=()=>{w.value!=""?(DWLive.sendPublicChatMsg(w.value),w.value="",G(()=>{k.value.scrollTop=k.value.scrollHeight})):alert("请输入内容~！")},ce=t=>{if(!R.trim(t))return"";t=t.replace(/\</g,"&lt;"),t=t.replace(/\>/g,"&gt;"),t=t.replace(/\n/g,"<br/>"),t=t.replace(/\[em_([0-9]*)\]/g,'<img src="//view.csslcloud.net/img/em/$1.gif" border="0" />'),t=t.replace(/\[em2_([0-9]*)\]/g,'<img src="//view.csslcloud.net/img/em2/$1.png" border="0" />');var s="";return R.each(t.split(" "),function(E,a){if(a=R.trim(a),a.indexOf("[uri_")==0&&a.indexOf("]")==a.length-1&&a.length>6){var y=a.substring(5,a.length-1)+" ";s+='<a target="_blank" style="color: #2f53ff" href="'+y+'">'+y+"</a> "}else s+=a+" "}),s},re=()=>{let t=document.webkitFullscreenElement,s=document.getElementById("drawPanel");t?document.webkitCancelFullScreen():s.webkitRequestFullScreen(),setTimeout(()=>{g.value=!1},2e3)},ve=()=>{window.location.reload()},de=()=>{window.close()};return(t,s)=>{const E=Ee("el-svg-icon");return n(),c("div",Ae,[e("div",Le,[f.value?(n(),c("div",Ne,[d.value==1?(n(),c("div",We,[O(E,{name:"Loading",size:20,color:"#fff",class:"icon"}),xe])):F("",!0),d.value==2?(n(),c("div",Me,[qe,e("div",He,[e("div",{onClick:s[0]||(s[0]=a=>d.value=1)},"继续等待"),e("div",{onClick:s[1]||(s[1]=a=>ve())},"重新播放")])])):F("",!0),d.value==3?(n(),c("div",Re,[e("div",Oe,p(j.value),1),e("div",{class:"btn-con"},[e("div",{onClick:de},"我知道了")])])):F("",!0)])):F("",!0),e("div",Ye,[e("div",je,[e("div",Ve,[e("div",{class:"title oneEllipsis",title:u.value.liveChapterName},p(u.value.liveChapterName),9,ze),e("div",Ue,[Je,Y(" 直播时间： "+p(t.$dayjs(u.value.liveStartTime).format("YYYY-MM-DD HH:mm"))+" - "+p(t.$dayjs(u.value.liveEndTime).format("HH:mm")),1)])]),V.value?(n(),c("div",Ge,[Ke,Qe,e("div",{class:"player-Prompt-close",onClick:s[2]||(s[2]=a=>V.value=!1)},[Y(" 关闭 "),Xe])])):F("",!0),e("div",Ze,[e("div",{class:"player-main",onMouseover:s[4]||(s[4]=a=>g.value=!0),onMouseleave:s[5]||(s[5]=a=>g.value=!1)},[e("div",{class:D(["style1",C.value?"":"null"])},[e("div",et,[e("div",{class:"play-mask",onClick:s[3]||(s[3]=a=>g.value=!g.value)},[g.value?(n(),c("div",tt,[O(E,{name:"FullScreen",color:"#fff",size:30,class:"full-screen-btn",title:"点击全屏/取消全屏",onClick:re})])):F("",!0)])])],2),e("div",{class:D(C.value?"null":"playIsnull")},[st,e("div",lt,p(u.value.liveCourseStatus==0?"直播未开始":""),1)],2)],32)]),e("div",at,[e("div",ot,[e("img",{src:L.value.teacherPortrait,alt:""},null,8,ut)]),Y(" 讲师："+p(L.value.teacherName),1)])]),e("div",it,[e("div",nt,[e("div",ct,[e("div",{class:D(["style1",C.value?"":"null"])},vt,2),e("div",{class:D(C.value?"null":"playIsnull")},pt,2)])]),e("div",_t,[ft,e("div",{class:"msg-list",id:"msg-list",ref_key:"chatContent",ref:k},[(n(!0),c(be,null,De(N.value,(a,y)=>(n(),c("div",{class:D(a.username==W.value?"my msg-item":"msg-item"),key:y},[e("div",gt,p(a.username),1),e("div",ht,[e("div",{innerHTML:ce(a.msg)},null,8,Ct)])],2))),128))],512),e("div",yt,[e("div",Ft,[Se(e("input",{placeholder:"参与聊天","onUpdate:modelValue":s[6]||(s[6]=a=>w.value=a)},null,512),[[me,w.value]]),e("div",{class:"submit",onClick:s[7]||(s[7]=a=>ne())},"发送")])])])])])]),O(fe,{show:M.value,courseId:i.value,chapterId:v.value,onClickClose:le},null,8,["show","courseId","chapterId"])])}}}),Nt=Fe(It,[["__scopeId","data-v-761d72ab"]]);export{Nt as default};
