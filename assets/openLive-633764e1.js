import{aa as Y,aC as z}from"./webClient-e9003e98.js";import{_ as q}from"./zbz-53c88072.js";import{_ as R}from"./line-2545f1db.js";import{_ as j}from"./hot-4e4545bf.js";import{$ as D}from"./jquery-0491babd.js";import{u as U}from"./vue-router.esm-bundler-0ff22247.js";import{r as G,A as J}from"./accountClient-16268368.js";import{O as X}from"./openClient-47a3aec2.js";import{ae as K,f as Q,r as u,a as Z,o as ee,H as x,G as se,h as n,j as l,k as e,B as d,A as g,z as _,C as te,F as T,V as $,n as oe,x as ie,ag as ne,ah as le}from"./plugin-vue_export-helper-3a3407bb.js";import{X as ue}from"./index2-07a0ebff.js";import"./_commonjsHelpers-725317a4.js";import"./view-9aa2e42b.js";import"./hide-41630f68.js";const c=f=>(ne("data-v-49fbeb67"),f=f(),le(),f),ae={key:0,class:"pannel"},ce={class:"video-pannel"},re={class:"video-con"},de={class:"video-left"},ve={class:"video-title"},_e=["title"],me={class:"time"},pe=c(()=>e("img",{src:q,alt:""},null,-1)),he={key:0,class:"player-Prompt"},fe=c(()=>e("div",{class:"icon"},[e("i",{class:"iconfont iconzhuyi"})],-1)),ge=c(()=>e("div",{class:"text"}," 课程视频版权所有，禁止任何形式得转载！并未经本公司书面许可的使用行为，我公司均保留追究法律责任的权利。 ",-1)),Ce=c(()=>e("i",{class:"iconfont iconguanbi"},null,-1)),Fe={class:"video-block"},ke={id:"drawPanel",style:{width:"100%",height:"100%"}},ye={key:0,class:"setting-pannel"},be={class:"teacher"},De={class:"tea-img"},Ee=["src"],Be={key:0,class:"video-right"},we=c(()=>e("div",{class:"player-function"},[e("div",{class:"teacher-video"},[e("div",{class:"style1"},[e("div",{id:"livePlayer",style:{width:"100%",height:"100%",position:"relative","border-radius":"10px",overflow:"hidden"}})])])],-1)),Ae={class:"playback"},Se=c(()=>e("div",{class:"text"},"聊天区",-1)),Le={class:"name"},xe=["innerHTML"],Te={class:"msg-btn"},$e={class:"btn-block"},Pe={class:"content-con"},Me={class:"con-ago"},Ne=c(()=>e("div",{class:"ago-title"},[e("span",{class:"title"},"推荐公开课"),e("img",{src:R,alt:""})],-1)),Ie={class:"list"},Oe={class:"item-con"},He=["src"],We={class:"con-info"},Ve={class:"title twoEllipsis"},Ye={class:"num-con"},ze=c(()=>e("div",{class:"tag"},"限免",-1)),qe={class:"num"},Re=c(()=>e("img",{src:j,alt:""},null,-1)),je={class:"time-con"},Ue={class:"time"},Ge={key:1,class:"btn btn2"},Je=["onClick"],Xe={key:3,class:"btn btn4"},Ke=["onClick"],Qe=Q({__name:"openLive",setup(f){let C=new X,E=new J;const v=u(!1),F=u(!0),B=u(!0),P=U(),k=u(),m=u(""),y=u(""),i=u({}),w=u({}),b=u([]),A=u([]),p=u();Z(()=>{i.value.liveCourseStatus==1&&F.value&&DWLive.destroy()}),ee(async()=>{k.value=P.query.id;let t=await E.checkLogIn();t&&(w.value=t,S())});const S=()=>{C.getDetail(k.value).then(t=>{i.value=t.data,document.title=t.data.openCourseName,t.data.liveCourseStatus==0&&(F.value=!1),t.data.liveCourseStatus==1&&O(),M()})},M=()=>{C.queryOpenRecommend(1,12).then(t=>{A.value=t.data.rows})},L=async(t,o)=>{await E.checkLogIn()&&(t==1?window.location.href=`/openLive?id=${o}`:window.location.href=`/openLiveback?id=${o}`)},N=()=>{C.addOpenScheduled(k.value).then(t=>{t.code==0&&S()})},I=()=>{m.value==""?z.warning("请输入内容！"):(DWLive.sendPublicChatMsg(m.value),m.value="",x(()=>{p.value.scrollTop=p.value.scrollHeight}))},O=()=>{if(i.value.playLink!="")var t=i.value.playLink,o=t.split("&")[0],h=o.split("=")[1],s=t.split("&")[1],r=s.split("=")[1];y.value=w.value.nickName,DWLive.init({userid:r,roomid:h,viewertoken:"123",pcH5Live:!0,viewername:y.value}),DWLive.onLoginSuccess=function(a){a.live.liveDuration<0&&(F.value=!1,ue.alert("直播等待中~","提示",{confirmButtonText:"确定",showClose:!1,callback:()=>{G.back()}}))},DWLive.onLiveStart=function(a){console.log(a)},DWLive.onLiveEnd=function(a){console.log(a)},DWLive.onPublicChatMessage=function(a){console.log("-------------------接收公聊-------------------");let V=JSON.parse(a);b.value=b.value.concat(V),x(()=>{p.value.scrollTop=p.value.scrollHeight})}},H=t=>{if(!D.trim(t))return"";t=t.replace(/\</g,"&lt;"),t=t.replace(/\>/g,"&gt;"),t=t.replace(/\n/g,"<br/>"),t=t.replace(/\[em_([0-9]*)\]/g,'<img src="//view.csslcloud.net/img/em/$1.gif" border="0" />'),t=t.replace(/\[em2_([0-9]*)\]/g,'<img src="//view.csslcloud.net/img/em2/$1.png" border="0" />');var o="";return D.each(t.split(" "),function(h,s){if(s=D.trim(s),s.indexOf("[uri_")==0&&s.indexOf("]")==s.length-1&&s.length>6){var r=s.substring(5,s.length-1)+" ";o+='<a target="_blank" style="color: #2f53ff" href="'+r+'">'+r+"</a> "}else o+=s+" "}),o},W=()=>{let t=document.webkitFullscreenElement,o=document.getElementById("drawPanel");t?document.webkitCancelFullScreen():o.webkitRequestFullScreen(),setTimeout(()=>{v.value=!1},2e3)};return(t,o)=>{const h=se("el-svg-icon");return i.value?(n(),l("div",ae,[e("div",ce,[e("div",re,[e("div",de,[e("div",ve,[e("div",{class:"title oneEllipsis",title:i.value.openCourseName},d(i.value.openCourseName),9,_e),e("div",me,[pe,g(" 直播时间： "+d(i.value.liveStartTime)+" - "+d(i.value.liveEndTime?i.value.liveEndTime.substring(10):""),1)])]),B.value?(n(),l("div",he,[fe,ge,e("div",{class:"player-Prompt-close",onClick:o[0]||(o[0]=s=>B.value=!1)},[g(" 关闭 "),Ce])])):_("",!0),e("div",Fe,[e("div",{class:"player-main",onMouseover:o[2]||(o[2]=s=>v.value=!0),onMouseleave:o[3]||(o[3]=s=>v.value=!1)},[e("div",ke,[e("div",{class:"play-mask",onClick:o[1]||(o[1]=s=>v.value=!v.value)},[v.value?(n(),l("div",ye,[te(h,{name:"FullScreen",color:"#fff",size:30,class:"full-screen-btn",title:"点击全屏/取消全屏",onClick:W})])):_("",!0)])])],32)]),e("div",be,[e("div",De,[e("img",{src:i.value.teacherPortrait,alt:""},null,8,Ee)]),g(" 讲师："+d(i.value.teacherName),1)])]),i.value.liveCourseStatus==1?(n(),l("div",Be,[we,e("div",Ae,[Se,e("div",{class:"msg-list",id:"msg-list",ref_key:"chatContent",ref:p},[(n(!0),l(T,null,$(b.value,(s,r)=>(n(),l("div",{class:oe(s.username==y.value?"my msg-item":"msg-item"),key:r},[e("div",Le,d(s.username),1),e("div",{class:"msg",innerHTML:H(s.msg)},null,8,xe)],2))),128))],512),e("div",Te,[e("div",$e,[ie(e("input",{placeholder:"参与聊天","onUpdate:modelValue":o[4]||(o[4]=s=>m.value=s)},null,512),[[Y,m.value]]),e("div",{class:"submit",onClick:o[5]||(o[5]=s=>I())},"发送")])])])])):_("",!0)])]),e("div",Pe,[e("div",Me,[Ne,e("div",Ie,[(n(!0),l(T,null,$(A.value,(s,r)=>(n(),l("div",{class:"list-item",key:r},[e("div",Oe,[e("img",{src:s.surfacePlot,alt:""},null,8,He),e("div",We,[e("div",Ve,d(s.openCourseName),1),e("div",Ye,[ze,e("div",qe,[Re,g(" "+d(s.heatDegree)+"人气值 ",1)])])])]),e("div",je,[e("div",Ue,"开播时间："+d(t.$dayjs(s.liveStartTime).format("YYYY-MM-DD HH:mm")),1),s.liveCourseStatus==0&&s.scheduledStatus==0?(n(),l("div",{key:0,class:"btn btn1",onClick:o[6]||(o[6]=a=>N())},"立即预约")):_("",!0),s.liveCourseStatus==0&&s.scheduledStatus==1?(n(),l("div",Ge,"预约成功 ")):s.liveCourseStatus==1?(n(),l("div",{key:2,class:"btn btn3",onClick:a=>L(1,s.openCourseId)},"进入直播 ",8,Je)):s.liveCourseStatus==2?(n(),l("div",Xe,"回放生成中")):s.liveCourseStatus==3?(n(),l("div",{key:4,class:"btn btn5",onClick:a=>L(2,s.openCourseId)},"观看课程 ",8,Ke)):_("",!0)])]))),128))])])])])):_("",!0)}}}),vs=K(Qe,[["__scopeId","data-v-49fbeb67"]]);export{vs as default};
