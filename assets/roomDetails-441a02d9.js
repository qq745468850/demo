import{Q as E}from"./QuestionItem-24928d53.js";import{q as C}from"./enum-012db698.js";import{E as j}from"./examClient-b11362c9.js";import{A as q}from"./accountClient-b6fbd578.js";import"./webClient-2e88593a.js";import{_ as L}from"./plugin-vue_export-helper-c27b6911.js";import{G as S,X as B,h as i,j as r,k as n,B as c,z as y,A as f,x as D,F as v,V as w,n as g,C as b,v as P,af as V,ag as F}from"./runtime-core.esm-bundler-201072b8.js";import"./coachClient-6606bd3e.js";import"./commonjsHelpers-725317a4.js";import"./vue-router.esm-bundler-926c5a09.js";let N=new q,x=new j;const M={components:{QuestionItem:E},data(){return{QuestionEnum:C,process:{},roomId:"",paperId:"",examType:"",classId:"",room:{},num:0,time:"",dialogImageUrl:"",dialogVisible:!1,showMask:!0,loading:!1,userInfo:{},nextTestId:0,shijuan:{},questionList:[],isSubmit:!1,sendFlag:!0,totalScore:0,start:!0,tasksId:11}},watch:{time(){this.time.Dvalue<=0&&(clearTimeout(this.timeEnd),this.submitPaper())}},destroyed(){document.removeEventListener("keydown",this.keydownListener),window.removeEventListener("beforeunload",e=>{this.beforeunloadHandler(e)}),window.removeEventListener("scroll",this.handleScroll),window.onselectstart=function(){return!0},window.oncontextmenu=function(){return!0},this.$forceUpdate()},async created(){if(this.paperId=this.$route.query.id,this.roomId=this.$route.query.roomId,this.examType=this.$route.query.examType,this.classId=this.$route.query.classId,!this.paperId||!this.roomId){this.$notify({title:"提示",message:"缺少必要参数",type:"warning",duration:2e3}),setTimeout(()=>{this.$router.go(-1)},2e3);return}let e=await N.checkLogIn();e&&(this.userInfo=e,this.getPaperTopicById(this.paperId),window.onselectstart=function(){return!1},window.oncontextmenu=function(){return!1},window.addEventListener("beforeunload",s=>{this.beforeunloadHandler(s)}),document.addEventListener("keydown",this.keydownListener),window.addEventListener("scroll",this.handleScroll,!0))},methods:{async submitPaper(){if(this.start=await!0,!this.sendFlag)return;this.sendFlag=await!1,await this.checkBoxChangeString(this.shijuan);let e=parseInt(this.time.hours*60+Number(this.time.minutes)+this.time.seconds/60);(await x.submitPaper(this.examType,this.paperId,this.shijuan,e,this.classId?this.classId:void 0,void 0,this.roomId)).code==0&&(await x.receiveTaskRecord(this.tasksId),setTimeout(()=>{this.$router.go(-1)},2e3)),this.sendFlag=await!0},getPaperTopicById(){this.loading=!0,x.getPaperTopicById(this.paperId).then(e=>{e.code==0?(this.shijuan=e.data,this.checkBoxChangeArray(this.shijuan),parseInt(this.shijuan.time)>0&&this.countTime(parseInt(this.shijuan.time)*60*1e3)):alert(e.msg),this.loading=!1})},checkBoxChangeArray(e){e.paperTopicList.forEach((s,h)=>{s.questionTopicList.forEach((a,t)=>{this.num=a.topicIndex>this.num?a.topicIndex:this.num,s.topicType=="1"&&(a.userAnswer?a.userAnswer=a.userAnswer.split(","):a.userAnswer=[]),s.topicType=="5"&&a.subTopicList.forEach((o,p)=>{o.questionType=="1"&&(o.userAnswer?o.userAnswer=o.userAnswer.split(","):o.userAnswer=[]),this.num=o.topicIndex>this.num?o.topicIndex:this.num})})})},checkBoxChangeString(e){e.paperTopicList.forEach((s,h)=>{s.questionTopicList.forEach((a,t)=>{this.num=a.topicIndex>this.num?a.topicIndex:this.num,s.topicType=="1"&&(a.userAnswer?a.userAnswer=a.userAnswer.toString():a.userAnswer=""),s.topicType=="5"&&a.subTopicList.forEach((o,p)=>{o.questionType=="1"&&(o.userAnswer?o.userAnswer=o.userAnswer.toString():o.userAnswer=""),this.num=o.topicIndex>this.num?o.topicIndex:this.num})})})},StartOrEnd(){this.isSubmit||(this.start?(clearTimeout(this.timeEnd),this.start=!1):(this.countTime(this.time.Dvalue),this.start=!0),this.$forceUpdate())},countTime(e){var s=e-1e3,h=Math.floor(s/(24*3600*1e3)),a=s%(24*3600*1e3),t=Math.floor(a/(3600*1e3)),o=a%(3600*1e3),p=Math.floor(o/(60*1e3)),I=o%(60*1e3),_=Math.round(I/1e3);t<10&&(t="0"+t),p<10&&(p="0"+p),_<10&&(_="0"+_),this.time={days:h,hours:t,minutes:p,seconds:_,Dvalue:s},this.timeEnd=setTimeout(()=>{this.countTime(this.time.Dvalue)},1e3)},jumpShiTi(e){$("html, body").animate({scrollTop:$("#"+e).offset().top},400)},backTop(){let e=setInterval(()=>{let s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,h=Math.ceil(s/5);document.documentElement.scrollTop=s-h,s===0&&clearInterval(e)},20)},handleScroll(){window.pageYOffset>=400?$(".shiti-function").addClass("fixed-card"):$(".shiti-function").removeClass("fixed-card")},keydownListener(){window.onkeydown=function(e){var s=window.event||e,h=s.keyCode||s.which;h==116&&(s.preventDefault?s.preventDefault():(s.keyCode=0,s.returnValue=!1))}},beforeunloadHandler(e){return e=e||window.event,e&&(e.returnValue="系统可能不会保存您所做的更改。"),"系统可能不会保存您所做的更改。"}}},l=e=>(V("data-v-019803f5"),e=e(),F(),e),O={class:"pannel"},Q={class:"pannel-con"},z={class:"shijuan-block"},H={class:"shijuan-title"},U={key:0,class:"grade"},G={key:0,class:"content"},Y=l(()=>n("br",null,null,-1)),R={key:1,class:"content"},X=l(()=>n("div",{class:"warning"},"本套试卷含有主观题，请自行参考解析评分",-1)),J=l(()=>n("div",{class:"warning mt10"},"提示：刷新或关闭当前页面不会保存做题记录",-1)),K={class:"block"},W={class:"shiti-block"},Z={key:0,class:"start-mask"},ee=l(()=>n("div",{class:"text"},"已暂停",-1)),se=[ee],te={class:"shiti-function ExamAside autoFixed"},ne={class:"control"},oe={class:"control-header"},ie={class:"timebox"},re=l(()=>n("i",{class:"glyphicon glyphicon-time"},null,-1)),ae=l(()=>n("i",{class:"el-icon-video-pause"},null,-1)),ce={key:0},de={key:1},ue={class:"content"},le=l(()=>n("i",{class:"iconfont iconfanhui1"},null,-1)),he={class:"sheet numberPannel"},pe={class:"sheet-header"},me=l(()=>n("div",null,"答题卡",-1)),fe={class:"num"},_e={class:"sheet-block"},ve={key:0},we={class:"t-title"},ye=l(()=>n("span",{class:"t-name"},"组合题",-1)),Ie=["onClick"],Te={key:1},ke={class:"t-title"},ge={class:"t-name"},xe={class:"t-numberbox"},Se=["onClick"],be={class:"btnlist"};function Ae(e,s,h,a,t,o){const p=S("question-item"),I=S("el-button"),_=B("loading");return i(),r("div",O,[n("div",Q,[n("div",z,[n("div",H,[t.isSubmit?(i(),r("div",U,c(t.shijuan.userScore),1)):y("",!0),f(" "+c(t.shijuan.paperName),1)]),t.isSubmit?(i(),r("div",R,"试卷已提交")):(i(),r("div",G,[f(" ◇ 作答时间为"+c(t.shijuan.time)+"分钟，总共"+c(t.shijuan.allScore)+"分，"+c(t.shijuan.passScore)+"分及格",1),Y,f(" ◇ 试卷来源：本站 ")])),X,J]),n("div",K,[D((i(),r("div",W,[(i(!0),r(v,null,w(t.shijuan.paperTopicList,(d,T)=>(i(),r("div",{key:T},[b(p,{paperId:t.paperId,isSubmit:t.isSubmit,item:d},null,8,["paperId","isSubmit","item"])]))),128)),t.start?y("",!0):(i(),r("div",Z,se))])),[[_,t.loading]]),n("div",te,[n("div",ne,[n("div",oe,[n("span",ie,[re,f(" 剩余时间 "),t.time?(i(),r("span",{key:0,class:g(t.start?"countdown":"red countdown")},c(t.time.hours)+":"+c(t.time.minutes)+":"+c(t.time.seconds),3)):y("",!0)]),t.isSubmit?y("",!0):(i(),r("div",{key:0,class:"time-pause",onClick:s[0]||(s[0]=d=>o.StartOrEnd())},[ae,t.start?(i(),r("span",ce,"暂停")):(i(),r("span",de,"开始"))]))]),n("div",ue,[n("a",{class:"btn btn-zt pointer",onClick:s[1]||(s[1]=d=>e.$router.go(-1))},[le,f("   返回列表 ")])])]),n("div",he,[n("div",pe,[me,n("div",fe,"共"+c(t.num)+"题",1)]),n("div",_e,[(i(!0),r(v,null,w(t.shijuan.paperTopicList,(d,T)=>(i(),r("div",{class:"T-Group",key:T},[d.topicType=="5"?(i(),r("div",ve,[n("div",we,[ye,f(" 总共"+c(d.score)+"分 共"+c(d.questionTopicList.length)+"题 ",1)]),(i(!0),r(v,null,w(d.questionTopicList,(u,k)=>(i(),r("ul",{class:"t-numberbox",key:k},[(i(!0),r(v,null,w(u.subTopicList,(m,A)=>(i(),r("li",{class:g([m.userAnswer&&m.userAnswer!=""?"on":"",m.userScore!=0&&m.userScore?"green":"",m.userScore==0?"red":""]),key:A,onClick:Ee=>o.jumpShiTi(m.topicIndex)},c(m.topicIndex),11,Ie))),128))]))),128))])):(i(),r("div",Te,[n("div",ke,[n("span",ge,c(t.QuestionEnum[Number(d.topicType)]),1),f(" 每题"+c(d.score)+"分 共"+c(d.questionTopicList.length)+"题 ",1)]),n("ul",xe,[(i(!0),r(v,null,w(d.questionTopicList,(u,k)=>(i(),r("li",{class:g([u.userAnswer&&u.userAnswer!=""?"on":"",u.userScore!=0&&u.userScore?"green":"",u.userScore==0?"red":""]),key:k,onClick:m=>o.jumpShiTi(u.topicIndex)},c(u.topicIndex),11,Se))),128))])]))]))),128))]),n("div",be,[b(I,{type:"info",class:"saveBtn",onClick:s[2]||(s[2]=d=>o.submitPaper()),plain:""},{default:P(()=>[f("交卷，并返回")]),_:1})])])])])])])}const Me=L(M,[["render",Ae],["__scopeId","data-v-019803f5"]]);export{Me as default};
