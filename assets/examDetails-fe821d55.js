import{Q as P}from"./QuestionItem-35378a43.js";import{q}from"./enum-245cc125.js";import{E as B}from"./examClient-2e75eb72.js";import{A as L}from"./accountClient-16268368.js";import"./webClient-e9003e98.js";import{ae as R,G as b,X as D,h as n,j as r,k as o,B as u,z as y,A as d,x as F,F as w,V as _,n as S,t as T,C as A,v as j,ag as V,ah as O}from"./plugin-vue_export-helper-3a3407bb.js";import"./coachClient-9554e82c.js";import"./_commonjsHelpers-725317a4.js";import"./vue-router.esm-bundler-0ff22247.js";let M=new L,g=new B;const N={components:{QuestionItem:P},data(){return{QuestionEnum:q,isImportRecord:!1,loading:!1,userInfo:{},paperId:"",classId:"",courseId:"",chapterId:"",examType:12,shijuan:{},timeEnd:"",time:{days:0,hours:0,minutes:0,seconds:0,Dvalue:0},start:!0,userAnswer:[],num:0,isSubmit:!1,sendFlag:!0,unUserAnswer:0,subjective:!1,roomResultId:""}},watch:{time(){this.time.Dvalue<=0&&(clearTimeout(this.timeEnd),this.submitPaper())}},destroyed(){document.removeEventListener("keydown",this.keydownListener),window.removeEventListener("beforeunload",e=>{this.beforeunloadHandler(e)}),window.removeEventListener("scroll",this.handleScroll),window.onselectstart=function(){return!0},window.oncontextmenu=function(){return!0},this.$forceUpdate()},async created(){if(this.paperId=this.$route.query.id,this.examType=this.$route.query.examType?this.$route.query.examType:12,!this.paperId){this.$notify({title:"提示",message:"试卷id不能为空",type:"warning",duration:2e3}),setTimeout(()=>{this.$router.go(-1)},2e3);return}this.classId=this.$route.query.classId?this.$route.query.classId:"",this.courseId=this.$route.query.courseId?this.$route.query.courseId:"",this.chapterId=this.$route.query.chapterId?this.$route.query.chapterId:"";let e=await M.checkLogIn();e&&(this.userInfo=await e,await this.checkSaveProgress(),window.onselectstart=function(){return!1},window.oncontextmenu=function(){return!1},window.addEventListener("beforeunload",s=>{this.beforeunloadHandler(s)}),document.addEventListener("keydown",this.keydownListener),window.addEventListener("scroll",this.handleScroll,!0))},methods:{async checkSaveProgress(){(await g.checkSaveProgress(this.examType,this.paperId,this.classId?this.classId:void 0,this.courseId?this.courseId:void 0,this.chapterId?this.chapterId:void 0)).data?this.$confirm("是否导入上次回答","提示",{confirmButtonText:"确定",cancelButtonText:"重新做答",type:"warning",closeOnClickModal:!1,closeOnPressEscape:!1}).then(async()=>{this.isImportRecord=!0,this.getPaperResult()}).catch(async()=>{this.getPaperTopicById()}):this.getPaperTopicById()},getPaperResult(){this.loading=!0,g.getPaperResult(this.examType,this.paperId,this.classId?this.classId:void 0,this.courseId?this.courseId:void 0,this.chapterId?this.chapterId:void 0).then(e=>{e.code==0?(this.shijuan=e.data,this.isHasInput(),parseInt(this.shijuan.time)>0&&this.countTime(parseInt(this.shijuan.time)*60*1e3),this.checkBoxChangeArray(this.shijuan)):alert(e.msg),this.loading=!1})},getPaperTopicById(){this.loading=!0,g.getPaperTopicById(this.paperId).then(e=>{e.code==0?(this.shijuan=e.data,this.isHasInput(),this.checkBoxChangeArray(this.shijuan),parseInt(this.shijuan.time)>0&&this.countTime(parseInt(this.shijuan.time)*60*1e3)):alert(e.msg),this.loading=!1})},async submitPaper(){if(this.start=await!0,!this.sendFlag)return;this.sendFlag=await!1,await this.checkBoxChangeString(this.shijuan);let e=this.time.hours*60+this.time.minutes+this.time.seconds/60;(await g.submitPaper(this.examType,this.paperId,this.shijuan,parseInt(e),this.classId?this.classId:void 0,this.courseId?this.courseId:void 0,void 0,this.chapterId?this.chapterId:void 0)).code==0&&(clearTimeout(this.timeEnd),this.isSubmit=!0,this.getPaperResult(),this.backTop()),this.sendFlag=await!0},clickSaveProgressBtn(){this.unUserAnswer=0;for(let e of this.shijuan.paperTopicList)if(e.topicType=="5")for(let s of e.questionTopicList)for(let l of s.subTopicList)(!l.userAnswer||l.userAnswer.length==0)&&this.unUserAnswer++;else for(let s of e.questionTopicList)(!s.userAnswer||s.userAnswer.length==0)&&this.unUserAnswer++;this.$confirm(`您还有 ${this.unUserAnswer} 道题未做答，是否确定下次再答`,"提示",{confirmButtonText:"继续做答",cancelButtonText:"下次继续",type:"warning",showClose:!1,closeOnClickModal:!1,closeOnPressEscape:!1}).then(()=>{}).catch(()=>{this.saveProgress()})},async saveProgress(){if(!this.sendFlag)return;this.sendFlag=await!1,await this.checkBoxChangeString(this.shijuan);let e=parseInt(this.time.hours*60+Number(this.time.minutes)+this.time.seconds/60);(await g.saveProgress(this.examType,this.paperId,this.shijuan,e,this.classId?this.classId:void 0,this.courseId?this.courseId:void 0)).code==0&&this.$router.go(-1),this.sendFlag=await!0},isHasInput(){for(let e of this.shijuan.paperTopicList)e.topicType=="0"||e.topicType=="1"||e.topicType=="2"?this.subjective=!1:this.subjective=!0},checkBoxChangeArray(e){e.paperTopicList.forEach((s,l)=>{s.questionTopicList.forEach((a,t)=>{this.num=a.topicIndex>this.num?a.topicIndex:this.num,s.topicType=="1"&&(a.userAnswer?a.userAnswer=a.userAnswer.split(","):a.userAnswer=[]),s.topicType=="5"&&a.subTopicList.forEach((i,p)=>{i.questionType=="1"&&(i.userAnswer?i.userAnswer=i.userAnswer.split(","):i.userAnswer=[]),this.num=i.topicIndex>this.num?i.topicIndex:this.num})})})},checkBoxChangeString(e){e.paperTopicList.forEach((s,l)=>{s.questionTopicList.forEach((a,t)=>{this.num=a.topicIndex>this.num?a.topicIndex:this.num,s.topicType=="1"&&(a.userAnswer?a.userAnswer=a.userAnswer.toString():a.userAnswer=""),s.topicType=="5"&&a.subTopicList.forEach((i,p)=>{i.questionType=="1"&&(i.userAnswer?i.userAnswer=i.userAnswer.toString():i.userAnswer=""),this.num=i.topicIndex>this.num?i.topicIndex:this.num})})})},rePlayGetShitiList(){this.$router.go(0),this.backTop()},StartOrEnd(){this.isSubmit||(this.start?(clearTimeout(this.timeEnd),this.start=!1):(this.countTime(this.time.Dvalue),this.start=!0),this.$forceUpdate())},countTime(e){var s=e-1e3,l=Math.floor(s/(24*3600*1e3)),a=s%(24*3600*1e3),t=Math.floor(a/(3600*1e3)),i=a%(3600*1e3),p=Math.floor(i/(60*1e3)),I=i%(60*1e3),m=Math.round(I/1e3);t<10&&(t="0"+t),p<10&&(p="0"+p),m<10&&(m="0"+m),this.time={days:l,hours:t,minutes:p,seconds:m,Dvalue:s},this.timeEnd=setTimeout(()=>{this.countTime(this.time.Dvalue)},1e3)},jumpShiTi(e){$("html, body").animate({scrollTop:$("#"+e).offset().top},400)},backTop(){let e=setInterval(()=>{let s=window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop,l=Math.ceil(s/5);document.documentElement.scrollTop=s-l,s===0&&clearInterval(e)},20)},handleScroll(){window.pageYOffset>=400?$(".shiti-function").addClass("fixed-card"):$(".shiti-function").removeClass("fixed-card")},keydownListener(){window.onkeydown=function(e){var s=window.event||e,l=s.keyCode||s.which;l==116&&(s.preventDefault?s.preventDefault():(s.keyCode=0,s.returnValue=!1))}},beforeunloadHandler(e){return e=e||window.event,e&&(e.returnValue="系统可能不会保存您所做的更改。"),"系统可能不会保存您所做的更改。"}}},v=e=>(V("data-v-fef97d72"),e=e(),O(),e),U={key:0,class:"pannel"},H={class:"pannel-con"},G={class:"shijuan-block"},Q={class:"shijuan-title"},z={key:0,class:"grade"},Y={key:0,class:"content"},X=v(()=>o("br",null,null,-1)),J={key:1,class:"content"},K=v(()=>o("div",{class:"warning"},"本套试卷含有主观题，请自行参考解析评分",-1)),W={class:"block"},Z={class:"shiti-block"},ee={key:0,class:"start-mask"},se=v(()=>o("div",{class:"text"},"已暂停",-1)),te=[se],ie={class:"shiti-function"},ne={class:"control"},oe={class:"control-header"},re={class:"timebox"},ae=v(()=>o("i",{class:"glyphicon glyphicon-time"},null,-1)),ce={key:2},ue={key:3},le=v(()=>o("span",null,"刷新",-1)),de={class:"content"},he=v(()=>o("i",{class:"iconfont iconfanhui1"},null,-1)),pe={class:"sheet numberPannel"},me={class:"sheet-header"},fe=v(()=>o("div",null,"答题卡",-1)),ve={class:"num"},ye={class:"sheet-block"},Ie={key:0},we={class:"t-title"},_e=v(()=>o("span",{class:"t-name"},"组合题",-1)),ge=["onClick"],Te={key:1},ke={class:"t-title"},xe={class:"t-name"},be={class:"t-numberbox"},Se=["onClick"],Ae={class:"btnlist"};function je(e,s,l,a,t,i){const p=b("question-item"),I=b("el-svg-icon"),m=b("el-button"),C=D("loading");return t.shijuan?(n(),r("div",U,[o("div",H,[o("div",G,[o("div",Q,[t.isSubmit?(n(),r("div",z,u(t.shijuan.userScore),1)):y("",!0),d(" "+u(t.shijuan.paperName),1)]),t.isSubmit?(n(),r("div",J,"试卷已提交")):(n(),r("div",Y,[d(" ◇ 作答时间为"+u(t.shijuan.time)+"分钟，总共"+u(t.shijuan.allScore)+"分，"+u(t.shijuan.passScore)+"分及格",1),X,d(" ◇ 试卷来源：本站 ")])),K]),o("div",W,[F((n(),r("div",Z,[(n(!0),r(w,null,_(t.shijuan.paperTopicList,(c,k)=>(n(),r("div",{key:k},[A(p,{paperId:t.paperId,isSubmit:t.isSubmit,item:c},null,8,["paperId","isSubmit","item"])]))),128)),t.start?y("",!0):(n(),r("div",ee,te))])),[[C,t.loading]]),o("div",ie,[o("div",ne,[o("div",oe,[o("span",re,[ae,d(" 剩余时间 "),t.time?(n(),r("span",{key:0,class:S(t.start?"countdown":"red countdown")},u(t.time.hours)+":"+u(t.time.minutes)+":"+u(t.time.seconds),3)):y("",!0)]),t.isSubmit?(n(),r("div",{key:1,class:"time-pause",onClick:s[1]||(s[1]=(...c)=>i.rePlayGetShitiList&&i.rePlayGetShitiList(...c))},[A(I,{name:"Refresh"}),le])):(n(),r("div",{key:0,class:"time-pause",onClick:s[0]||(s[0]=c=>i.StartOrEnd())},[t.start?(n(),T(I,{key:0,name:"VideoPause",color:"grey"})):(n(),T(I,{key:1,name:"VideoPlay",color:"grey"})),t.start?(n(),r("span",ce,"暂停")):(n(),r("span",ue,"开始"))]))]),o("div",de,[o("a",{class:"btn btn-zt pointer",onClick:s[2]||(s[2]=c=>e.$router.go(-1))},[he,d("   返回列表 ")])])]),o("div",pe,[o("div",me,[fe,o("div",ve,"共"+u(t.num)+"题",1)]),o("div",ye,[(n(!0),r(w,null,_(t.shijuan.paperTopicList,(c,k)=>(n(),r("div",{class:"T-Group",key:k},[c.topicType=="5"?(n(),r("div",Ie,[o("div",we,[_e,d(" 总共"+u(c.score)+"分 共"+u(c.questionTopicList.length)+"题 ",1)]),(n(!0),r(w,null,_(c.questionTopicList,(h,x)=>(n(),r("ul",{class:"t-numberbox",key:x},[(n(!0),r(w,null,_(h.subTopicList,(f,E)=>(n(),r("li",{class:S([f.userAnswer&&f.userAnswer!=""?"on":"",f.userScore!=0&&f.userScore&&!t.isImportRecord?"green":"",f.userScore==0&&!t.isImportRecord?"red":""]),key:E,onClick:Ce=>i.jumpShiTi(f.topicIndex)},u(f.topicIndex),11,ge))),128))]))),128))])):(n(),r("div",Te,[o("div",ke,[o("span",xe,u(t.QuestionEnum[Number(c.topicType)]),1),d(" 每题"+u(c.score)+"分 共"+u(c.questionTopicList.length)+"题 ",1)]),o("ul",be,[(n(!0),r(w,null,_(c.questionTopicList,(h,x)=>(n(),r("li",{class:S([h.userAnswer&&h.userAnswer!=""?"on":"",h.userScore!=0&&h.userScore&&!t.isImportRecord?"green":"",h.userScore==0&&!t.isImportRecord?"red":""]),key:x,onClick:f=>i.jumpShiTi(h.topicIndex)},u(h.topicIndex),11,Se))),128))])]))]))),128))]),o("div",Ae,[A(m,{type:"info",class:"saveBtn",disabled:t.isSubmit,onClick:s[3]||(s[3]=c=>i.clickSaveProgressBtn()),plain:""},{default:j(()=>[d(" 保存进度，下次继续")]),_:1},8,["disabled"]),t.isSubmit?y("",!0):(n(),T(m,{key:0,type:"primary",class:"submitBtn",onClick:s[4]||(s[4]=c=>i.submitPaper())},{default:j(()=>[d(" 交卷 ")]),_:1})),t.subjective&&t.isSubmit?(n(),T(m,{key:1,type:"primary",onClick:s[5]||(s[5]=c=>i.submitPaper()),class:"submitBlue"},{default:j(()=>[d(" 提交主观题分数")]),_:1})):y("",!0)])])])])])])):y("",!0)}const Oe=R(N,[["render",je],["__scopeId","data-v-fef97d72"]]);export{Oe as default};
